# ModelCompression-IntegratedGradients

Repository for the Model compression integrated gradients project

## Model Compression with Knowledge Distillation and Integrated Gradients

### Overview

This repository contains the implementation of our novel approach to model compression by integrating knowledge distillation (KD) with Integrated Gradients (IG) and attention transfer (AT), as described in our paper. This method is designed to enhance both performance and interpretability of compressed deep learning models.

### Repository Structure

```
.
├── Jupyter_notebooks # Notebooks for analysis and visualization
│ ├── Compression_vs_accuracy\*.ipynb # Notebooks for compression vs. accuracy studies
│ ├── IG_plots.ipynb # Notebook for Integrated Gradients plots
│ ├── ImageNet.ipynb # Notebook for ImageNet related studies
│ ├── Paper_plots.ipynb # Notebook for generating plots for the paper
│ ├── statistical.ipynb # Notebook for statistical analysis
│ └── studies_plot.py # Script for additional plotting
├── PyTorch_CIFAR10 # Scripts and models for CIFAR-10 dataset
│ ├── Compute_IGs.py # Script to compute and Integrated Gradients
│ ├── KD.py # Knowledge Distillation script
│ ├── UTILS_TORCH.py # All functions and classes using PyTorch's framework
│ ├── model_train.py # Script to train a model (baseline)
│ ├── montecarlo.py # Script to perform a montecarlo simulation
│ ├── param_search.py # Script to find the best parameters for KD
│ ├── precompute_img.py # Script to precompute all the teacher's logits
│ ├── cifar10_models # Teacher model script and weights
│ │ ├── mobilenetv2.py # Script for the teacher model
│ │ ├── state_dicts
│ │ │ └── mobilenet_v2.pt # weights for the teacher model
├── saved_models # Trained model weights
│ └── \*.pt # PyTorch model weights
├── README.md # This README file
└── LICENSE # License file
```

### Installation

---

#### Prerequisites

- Docker: Ensure Docker is installed on your system. Docker will be used to create an isolated environment that contains all the necessary dependencies. Visit [Docker's website](https://www.docker.com/get-started) for installation instructions.

#### Setting Up the Docker Container

To use the scripts, you will need to create a Docker container from the provided image. This image includes the basic environment and dependencies:

1. Pull the Docker Image

```
docker pull pytorch/pytorch
```

Pull the official PyTorch image from Docker Hub.

2. Run the docker container

```
docker run -it -v absolute/path/to/ModelCompression-IntegratedGradients:/workspace/ModelCompression-IntegratedGradients -p 8888:8888 --gpus all --ipc host --name <container name> <image name or id> bash
```

This command runs the container in interactive mode and starts a Bash shell.
It maps port 8888 for Jupyter notebooks, enables GPU support (if available), and sets up IPC namespace settings for PyTorch to perform optimally.

##### Handling Additional Dependencies

In case you encounter missing Python packages while running scripts within the Docker container, you can install these packages using `pip`. For example:

```
docker exec -it pytorch_container pip install <package name>
```

This command installs the required package inside the running container without needing to stop or rebuild the image.

### Usage

This section provides detailed instructions on how to use the scripts and notebooks included in this repository to reproduce the research results or to apply the methods to new data.

- Enter the running container

```
docker exec -it <container name> bash
```

If the container is not running:

```
docker start <container name>
docker exec -it <container name> bash
```

- Troubleshooting: If the container isn't responding, try restarting it:

```
docker restart <container name>
```

#### Running Jupyter Notebooks

1. Start Jupyter Notebook Server: To use the Jupyter notebooks, start the Jupyter server from within the Docker container:

```
jupyter notebook --ip 0.0.0.0 --port 8888 --no-browser --allow-root
```

This command starts a Jupyter notebook server inside the Docker container that you can access from your browser.

2. Access the Notebook: Open your browser and go to `http://localhost:8888`. You might need the token generated by the Jupyter server to log in, which is displayed in the terminal output.

3. Navigate to the Notebook: Once logged in, navigate to the `Jupyter_notebooks` directory and open the desired notebook file (e.g., `Compression_vs_accuracy.ipynb`).

#### Running Python Scripts

Ensure you are inside the Docker container, and run the sript:

```
python path/to/script.py
```

For example, to run a Monte Carlo simulation:

```
cd /workspace/ModelCompression-IntegratedGradients/PyTorch_CIFAR10/
python montecarlo.py
```

#### Exiting and Cleaning Up

- Exit the Container: Type `exit` to leave the container's shell.
- Stop the Container:

```
docker stop <container_name>
```

- Remove the Container: If you're done and want to clean up:

```
docker rm <container name>
```

- Remove the Docker Image: If you need to free up disk space:

```
docker rmi <image_name>
```

### Contributing

Contributions to this repository are welcome. Please fork the repository and submit a pull request with your proposed changes.

### License

This project is licensed under the Apache License - see the [LICENSE](LICENSE) file for details.

### Citation

If you use this code or our results in your research, please cite as:
